<%- include('./partials/header.ejs') %>
    <title>Loads</title>
    <!-- <style>
        .table {
        margin: auto;
        width: 75% !important;
        }
    </style> -->
    </head>

    <body>
        <%- include('./partials/navbar.ejs', {title: 'Loads' , active: 'Loads' }) %>
            <div class="table-responsive">
                <!-- <table class="table table-striped"> -->
                <table class="table table-striped table-hover mx-auto w-auto">
                    <thead>
                        <tr>
                            <!-- <th scope="col">Id</th> -->
                            <th scope="col">Volume</th>
                            <th scope="col">Content</th>
                            <th scope="col">Carrier</th>
                            <th scope="col">Created</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (items.length) {%>
                            <% items.forEach( load=> { %>
                                <tr>
                                    <td>
                                        <%= load.volume %>
                                    </td>
                                    <td>
                                        <%= load.content %>
                                    </td>
                                    <td>
                                        <a href="" class="btn btn-primary btn-rounded mb-4" data-toggle="modal"
                                            data-target="#LoadCarrierModal<%= load.id %>" id="saveLoadButton">Details
                                            <i class="fa fa-info-circle ml-1"></i></a>
                                        <!-- Pop-up for boat carrier details -->
                                        <div class="modal fade loadCarrierModal" id="LoadCarrierModal<%= load.id %>"
                                            tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                                            aria-hidden="true">
                                            <div class="modal-dialog" role="document">
                                                <div class="modal-content">
                                                    <div class="modal-header text-center">
                                                        <h4 class="modal-title w-100 font-weight-bold">Carrier
                                                        </h4>
                                                        <button type="button" class="close" data-dismiss="modal"
                                                            aria-label="Close">
                                                            <span aria-hidden="true">&times;</span>
                                                        </button>
                                                    </div>
                                                    <div class="modal-body mx-3">
                                                        <% for (const [k, v] of Object.entries(load.carrier)) { %>
                                                            <ul class="list-group">
                                                                <li class="list-group-item">
                                                                    <%= k %>: <%= v %>
                                                                </li>
                                                            </ul>
                                                            <%} %>
                                                    </div>
                                                </div>
                                            </div>
                                    </td>
                                    <td>
                                        <%= load.creationDate %>
                                    </td>
                                </tr>
                                <% }); %>
                                    <% }; %>
                    </tbody>
                </table>
                <div class="text-center">
                    <a href="" class="btn btn-primary btn-rounded mb-4" data-toggle="modal" data-target="#addLoadModal"
                        id="saveLoadButton">Add
                        Load <i class="fa fa-plus ml-1"></i></a>
                </div>
                <!-- Pop-up for adding load -->
                <div class="modal fade" id="addLoadModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header text-center">
                                <h4 class="modal-title w-100 font-weight-bold">Add</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <form id="loads_post_form" class="needs-validation" novalidate>
                                <div class="modal-body mx-3">
                                    <div class="md-form mb-3">
                                        <label data-error="wrong" data-success="right" for="loadVolume">Volume</label>
                                        <input type="text" id="loadVolume" name="volume" class="form-control validate"
                                            min="0" max="1000" value="" required>
                                    </div>

                                    <div class="md-form mb-3">
                                        <label data-error="wrong" data-success="right" for="loadContent">Content</label>
                                        <input type="text" id="loadContent" name="content" class="form-control validate"
                                            pattern="^[a-zA-Z0-9 ]{2,25}$" required>
                                    </div>
                                </div>
                                <div class="modal-footer d-flex justify-content-center">
                                    <button class="btn btn-indigo" type="submit">Add <i
                                            class="fa fa-plus ml-1"></i></button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

    </body>
    <script type="text/javascript" src="/javascript/handle_form.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Listen for adding load
            document
                .getElementById('loads_post_form')
                // TODO: Handle save.
                .addEventListener('submit', (ev) => {
                    handleSaveForm(ev, 201);
                }); // From handle_form
        });

    </script>

    </html>